<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<meta name="csrf-token" content="TbgGdtvGqCCBAXfH2oETchNOFJmOkhouLSQ3fpBk">
	<link rel="icon" href="https://magicmomentsportal.com/images/favicon/favicon.ico">
		
	<title> Magic Moments - Together Templates</title>

	<!-- Bootstrap core CSS -->

	<link rel="stylesheet" href="https://magicmomentsportal.com/css/bootstrap.css">
	<link rel="stylesheet" href="https://magicmomentsportal.com/css/GillSans.css">
	<link rel="stylesheet" href="https://magicmomentsportal.com/css/all.css">


	<!-- Sweet Alert -->
	<link href="https://magicmomentsportal.com/admin-lte/plugins/sweetalert2/sweetalert2.min.css" rel="stylesheet">
	<!-- Owl Carousal -->
	<link rel="stylesheet" href="https://magicmomentsportal.com/css/owl.carousel.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://magicmomentsportal.com/css/owl.theme.default.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

	<link rel="stylesheet" href="https://magicmomentsportal.com/css/prettyPhoto.css" type="text/css" media="screen" title="prettyPhoto main stylesheet" charset="utf-8" />

	<!-- Custom styles for this template -->
	<link rel="stylesheet" href="https://magicmomentsportal.com/css/frontend.css" media="all">
	<link rel="stylesheet" href="https://magicmomentsportal.com/css/print.css" media="print">

	<!-- Custom styles for date and time picker -->
	<link href="https://magicmomentsportal.com/css/bootstrap-datepicker.css" rel="stylesheet">
	<link href="https://magicmomentsportal.com/css/bootstrap-timepicker.css" rel="stylesheet">
	<link href="https://magicmomentsportal.com/css/select2.min.css" rel="stylesheet">
	<link href="https://magicmomentsportal.com/css/calentim.min.css" rel="stylesheet">

	<!-- Check Theme -->
	
	<!-- Body background image -->
	<style>
		body {
			font-family: "Gill Sans", "Gill Sans MT", "Myriad Pro", "DejaVu Sans Condensed", Helvetica, Arial, "sans-serif";
			background-color: #FFFFFF;
			margin: 0;
					}

		.menu_but-overlay {
			background: url('https://magicmomentsportal.com/') top left no-repeat;
			background-size: contain;
		}
	</style>

</head>

<body>
	<div class="mma-container">
		<div class="mma-header">
			<nav class="navbar navbar-expand-sm navbar">
				<!-- Check Roles -->
								<a class="navbar-brand"><img src="https://magicmomentsportal.com/images/mma_logo_full.png" alt="logo" width="340" height="60" /></a>
				<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample07" aria-controls="navbarsExample07" aria-expanded="false" aria-label="Toggle navigation">
					<!--<span class="navbar-toggler-icon"></span>-->
					<i class="fas fa-bars"> </i>
				</button>
				<div class="collapse navbar-collapse" id="navbarsExample07">
					<ul class="nav navbar-nav mma_head">
						<li class="nav-item" style="display:none;">
							<div class="header_brand"></div>
						</li>
						
						
												<!-- Abid 251122 start -->
												<!-- Abid 251122 end -->
						
						
																																																	<li class="nav-item"> <a href="https://magicmomentsportal.com"> <img src="https://magicmomentsportal.com/images/activities.png" alt="" width="80" height="60"><br>
									<span>Activities</span> </a>
							</li>

																										<li class="nav-item" id="mma_header_back"> <a href="https://magicmomentsportal.com/section/toolkit/templates-stationery?pages[0]=36" class="hBack"> <img src="https://magicmomentsportal.com/images/back_but.png" alt="" width="80" height="60"><br>
									Back </a>
							</li>
																	</ul>
				</div>
			</nav>
		</div>
		<!-- ./ Header Ends --><main class="mma-main">
    <div class="mma-content">
        <div class="row">
            <div class="col-sm-12">
                <h1 class="main-heading"> Together Templates </h1>
            </div>
        </div>
        <div class="row">
            <div class="col-2 col-md-3 col-lg-1 mma-nav">
                <!--<button type="button" role="presentation" class="owl-prev"> <img src="assets/img/slide_prev.png" alt="" width="90" height="150"> </button>-->
            </div>
            <div class="col-8 col-md-6 col-lg-10">
                                    <div class="owl-carousel">
                                                    <div class="page-container">
                                                                    <div class="mma_menu row" data-row-id="1">
                                                                                                                                <div class="col-lg-3 col-6">
                                                                                                <a href="https://magicmomentsportal.com/magic/assets/components/745f636f6d696e67736f6f6e5f66756c6c202831292e646f6378" target="_blank">
                                                    <div class="menu_but" style="background:rgb(237, 236, 237);">
                                                        <div class="menu_but-overlay" style="--menu-overlay:1/1;"></div>
                                                                                                                <div class="menu_icon" style="--menu-img:1/0.73;background:rgb(237, 236, 237);"> <img src="https://magicmomentsportal.com/magic/attachment/components/2284?thumb_250_270" alt="" width="178" height="130"> </div>
                                                        <div class="menu_txt" style="--menu-head:1/0.306;background-color:rgb(237, 236, 237); color:rgb(129,129,129)"> <span>Coming<br>
                                                                Soon</span><br>
                                                        </div>



                                                        <div class="menu_border"><div class="border-full" style="background-color:  #303030; "></div></div>
                                                    </div>
                                                </a>
                                            </div>
                                                                                                                                <div class="col-lg-3 col-6">
                                                                                                <a href="https://magicmomentsportal.com/magic/assets/components/745f63656c6562726174696f6e5f66756c6c2e646f6378" target="_blank">
                                                    <div class="menu_but" style="background:rgb(237, 236, 237);">
                                                        <div class="menu_but-overlay" style="--menu-overlay:1/1;"></div>
                                                                                                                <div class="menu_icon" style="--menu-img:1/0.73;background:rgb(237, 236, 237);"> <img src="https://magicmomentsportal.com/magic/attachment/components/2285?thumb_250_270" alt="" width="178" height="130"> </div>
                                                        <div class="menu_txt" style="--menu-head:1/0.306;background-color:rgb(237, 236, 237); color:rgb(129,129,129)"> <span>Celebration<br>
                                                                </span><br>
                                                        </div>



                                                        <div class="menu_border"><div class="border-full" style="background-color:  #303030; "></div></div>
                                                    </div>
                                                </a>
                                            </div>
                                                                                                                                <div class="col-lg-3 col-6">
                                                                                                <a href="https://magicmomentsportal.com/magic/assets/components/465348435f4d4d545f4d616b655f615f446966666572656e63655f54656d706c6174652e646f6378" target="_blank">
                                                    <div class="menu_but" style="background:rgb(237, 236, 237);">
                                                        <div class="menu_but-overlay" style="--menu-overlay:1/1;"></div>
                                                                                                                <div class="menu_icon" style="--menu-img:1/0.73;background:rgb(237, 236, 237);"> <img src="https://magicmomentsportal.com/magic/attachment/components/2286?thumb_250_270" alt="" width="178" height="130"> </div>
                                                        <div class="menu_txt" style="--menu-head:1/0.306;background-color:rgb(237, 236, 237); color:rgb(129,129,129)"> <span>Make a<br>
                                                                Difference</span><br>
                                                        </div>



                                                        <div class="menu_border"><div class="border-full" style="background-color:  #303030; "></div></div>
                                                    </div>
                                                </a>
                                            </div>
                                                                                                                                <div class="col-lg-3 col-6">
                                                                                                <a href="https://magicmomentsportal.com/magic/assets/components/4d4d545f74656d706c617465202838292e646f6378" target="_blank">
                                                    <div class="menu_but" style="background:rgb(237, 236, 237);">
                                                        <div class="menu_but-overlay" style="--menu-overlay:1/1;"></div>
                                                                                                                <div class="menu_icon" style="--menu-img:1/0.73;background:rgb(237, 236, 237);"> <img src="https://magicmomentsportal.com/magic/attachment/components/238?thumb_250_270" alt="" width="178" height="130"> </div>
                                                        <div class="menu_txt" style="--menu-head:1/0.306;background-color:rgb(237, 236, 237); color:rgb(129,129,129)"> <span>Planner<br>
                                                                </span><br>
                                                        </div>



                                                        <div class="menu_border"><div class="border-full" style="background-color:  #303030; "></div></div>
                                                    </div>
                                                </a>
                                            </div>
                                                                            </div>
                                                                    <div class="mma_menu row" data-row-id="2">
                                                                                                                                <div class="col-lg-3 col-6">
                                                                                                <a href="https://magicmomentsportal.com/magic/assets/components/436f6d696e675f736f6f6e5f54656d706c6174655f6e6577202832292e646f6378" target="_blank">
                                                    <div class="menu_but" style="background:rgb(237, 236, 237);">
                                                        <div class="menu_but-overlay" style="--menu-overlay:1/1;"></div>
                                                                                                                <div class="menu_icon" style="--menu-img:1/0.73;background:rgb(237, 236, 237);"> <img src="https://magicmomentsportal.com/magic/attachment/components/2287?thumb_250_270" alt="" width="178" height="130"> </div>
                                                        <div class="menu_txt" style="--menu-head:1/0.306;background-color:rgb(237, 236, 237); color:rgb(129,129,129)"> <span>Coming<br>
                                                                Soon</span><br>
                                                        </div>



                                                        <div class="menu_border"><div class="border-full" style="background-color:  #303030; "></div></div>
                                                    </div>
                                                </a>
                                            </div>
                                                                                                                                <div class="col-lg-3 col-6">
                                                                                                <a href="https://magicmomentsportal.com/magic/assets/components/43656c6562726174696f6e5f54656d706c617465202832292e646f6378" target="_blank">
                                                    <div class="menu_but" style="background:rgb(237, 236, 237);">
                                                        <div class="menu_but-overlay" style="--menu-overlay:1/1;"></div>
                                                                                                                <div class="menu_icon" style="--menu-img:1/0.73;background:rgb(237, 236, 237);"> <img src="https://magicmomentsportal.com/magic/attachment/components/2288?thumb_250_270" alt="" width="178" height="130"> </div>
                                                        <div class="menu_txt" style="--menu-head:1/0.306;background-color:rgb(237, 236, 237); color:rgb(129,129,129)"> <span>Celebration<br>
                                                                </span><br>
                                                        </div>



                                                        <div class="menu_border"><div class="border-full" style="background-color:  #303030; "></div></div>
                                                    </div>
                                                </a>
                                            </div>
                                                                                                                                <div class="col-lg-3 col-6">
                                                                                                <a href="https://magicmomentsportal.com/magic/assets/components/745f6d61645f626c2e646f6378" target="_blank">
                                                    <div class="menu_but" style="background:rgb(237, 236, 237);">
                                                        <div class="menu_but-overlay" style="--menu-overlay:1/1;"></div>
                                                                                                                <div class="menu_icon" style="--menu-img:1/0.73;background:rgb(237, 236, 237);"> <img src="https://magicmomentsportal.com/magic/attachment/components/2289?thumb_250_270" alt="" width="178" height="130"> </div>
                                                        <div class="menu_txt" style="--menu-head:1/0.306;background-color:rgb(237, 236, 237); color:rgb(129,129,129)"> <span>Make a<br>
                                                                Difference</span><br>
                                                        </div>



                                                        <div class="menu_border"><div class="border-full" style="background-color:  #303030; "></div></div>
                                                    </div>
                                                </a>
                                            </div>
                                                                                                                                <div class="col-lg-3 col-6">
                                                                                                <a href="https://magicmomentsportal.com/magic/assets/components/4d4d545f74656d706c617465202838292e646f6378" target="_blank">
                                                    <div class="menu_but" style="background:rgb(237, 236, 237);">
                                                        <div class="menu_but-overlay" style="--menu-overlay:1/1;"></div>
                                                                                                                <div class="menu_icon" style="--menu-img:1/0.73;background:rgb(237, 236, 237);"> <img src="https://magicmomentsportal.com/magic/attachment/components/238?thumb_250_270" alt="" width="178" height="130"> </div>
                                                        <div class="menu_txt" style="--menu-head:1/0.306;background-color:rgb(237, 236, 237); color:rgb(129,129,129)"> <span>Planner<br>
                                                                </span><br>
                                                        </div>



                                                        <div class="menu_border"><div class="border-full" style="background-color:  #303030; "></div></div>
                                                    </div>
                                                </a>
                                            </div>
                                                                            </div>
                                                            </div>
                                            </div>
                            </div>
            <div class="col-2 col-md-3 col-lg-1 mma-nav">
                <!--<button type="button" role="presentation" class="owl-next"> <img src="assets/img/slide_next.png" alt=""  width="90" height="150"> </button>-->
            </div>
        </div>
    </div>
</main>
<!-- ./ Content Ends -->
<!-- Check Theme -->

<footer class="mma-footer">
    <div class="footer_border"> <img src="https://magicmomentsportal.com/images/border_blank.png" alt="" width="980" height="30"> </div>
    <img src="https://magicmomentsportal.com/uploads/themes/uploads/fshcg_logo.png" alt="" width="210" height="46" class="footer-logo" />
</footer>
<div class="audio-settings" style="display:none;">
    <audio controls id="right_audio">
        <source src="https://magicmomentsportal.com/media/right.mp3" type="audio/mpeg">
    </audio>
    <audio controls id="wrong_audio">
        <source src="https://magicmomentsportal.com/media/wrong.mp3" type="audio/mpeg">
    </audio>
</div>
</div>


<!-- Loader -->
<style>
    * {
        margin: 0;
        padding: 0;
    }

    #loader {
        height: 100%;
        width: 100%;
        max-width: 100%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 9999;
    }

    #loader .box {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 150px;
        height: 150px;
        background: #d93c85;
        box-sizing: border-box;
        overflow: hidden;
        padding: 20px;
    }

    #loader .box:before {
        content: '';
        position: absolute;
        top: 0;
        /*left:-100%;*/
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.1);
        transition: 0.5s;
        pointer-events: none;
        left: -50%;
        transform: skewX(-15deg);
    }

    /*.box:hover:before{
        left:-50%;
        transform: skewX(-5deg);
    }*/

    #loader .box .content {

        text-align: center;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 110px;
    }

    #loader .box span {

        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: block;
        box-sizing: border-box;

    }

    #loader .box span:nth-child(1) {
        transform: rotate(0deg);
    }

    #loader .box span:nth-child(2) {
        transform: rotate(90deg);
    }

    #loader .box span:nth-child(3) {
        transform: rotate(180deg);
    }

    #loader .box span:nth-child(4) {
        transform: rotate(270deg);
    }

    #loader .box span:before {
        content: '';
        position: absolute;
        width: 100%;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        animation: animate 4s linear infinite;
    }

    @keyframes animate {
        0% {
            transform: scaleX(0);
            transform-origin: left;
        }

        50% {
            transform: scaleX(1);
            transform-origin: left;
        }

        50.1% {
            transform: scaleX(1);
            transform-origin: right;

        }

        100% {
            transform: scaleX(0);
            transform-origin: right;

        }
    }
</style>

<section id="loader">
    <div class="box">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <div class="content">
            <svg class="" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="90px" height="75px" viewBox="0 0 290.6 248.96" style="overflow:visible;enable-background:new 0 0 290.6 148.96;" xml:space="preserve">
                <style type="text/css">
                    .st1 {
                        fill-rule: evenodd;
                        clip-rule: evenodd;
                        fill: #FFF;
                    }
                </style>
                <defs></defs>
                <path class="st1" d="M0,0h91.68l53.62,172.89L198.92,0h91.67v248.96h-62.85l0.58-179.8l-52.47,179.8h-62.85L62.27,69.16l0.58,179.8
                H0V0z" />
            </svg>
        </div>
    </div>
</section>
<!-- Ends -->

<!-- Activity Reporting Style -->
<style>
    .ar-select-disabled {
        -webkit-appearance: none;
        -moz-appearance: none;
        text-indent: 1px;
        text-overflow: '';
        background-color: white !important;
        border: none !important;
        width: 100%;
    }

    .ar-input-disabled {
        -webkit-appearance: none;
        -moz-appearance: none;
        text-indent: 1px;
        text-overflow: '';
        background-color: white !important;
        border: none !important;
        width: 100%;
    }
</style>


<!-- Bootstrap core JavaScript
        ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<!-- jQuery -->
<script src="https://magicmomentsportal.com/admin-lte/plugins/jquery/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js" type="text/javascript"></script>
<!-- Bootstrap 4 -->
<script src="https://magicmomentsportal.com/admin-lte/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<!-- Popper -->
<script src="https://magicmomentsportal.com/js/vendor/popper.min.js"></script>
<!-- Sweet Alert -->
<script src="https://magicmomentsportal.com/admin-lte/plugins/sweetalert2/sweetalert2.all.min.js"></script>
<script src="https://magicmomentsportal.com/admin-lte/plugins/datatables/jquery.dataTables.min.js"></script>

<script src="https://magicmomentsportal.com/admin-lte/plugins/sweetalert2/sweetalert2.all.min.js"></script>

<script src="https://magicmomentsportal.com/js/owl.carousel.min.js"></script>

<script src="https://magicmomentsportal.com/js/jquery.prettyPhoto.js" type="text/javascript" charset="utf-8"></script>

<script src="https://magicmomentsportal.com/js/bootstrap-datepicker.min.js"></script>
<script src="https://magicmomentsportal.com/js/bootstrap-timepicker.min.js"></script>
<script src="https://magicmomentsportal.com/js/select2.min.js"></script>
<script src="https://magicmomentsportal.com/js/chartjs.min.js"></script>

<script src="https://magicmomentsportal.com/js/moment.min.js"></script>
<script src="https://magicmomentsportal.com/js/calentim.min.js"></script>
<script src="https://magicmomentsportal.com/js/jspdf.js"></script>



<script>
    var Toast = Swal.mixin({
        toast: true,
        position: 'center',
        showConfirmButton: false,
        timer: 5000
    });
    var message = '';
    var icon = '';
    if (message.length > 0) {
        Toast.fire({
            icon: icon,
            title: message
        });
    }
</script>



<script>
    /**
     *****************************************************
     *  Define all routes here
     ***************************************************** 
     */
    var get_quiz_data = "https://magicmomentsportal.com/get_quiz_data";
    var update_quiz_result = "https://magicmomentsportal.com/quizzes/competition-result";
    var congratulations = "https://magicmomentsportal.com/quizzes/congratulations";
    var competition_congratulations = "https://magicmomentsportal.com/quizzes/competition/congratulations";
    var update_user_activity = "https://magicmomentsportal.com/history/update-user-activity";
    var get_category_data = 'https://magicmomentsportal.com/activityreporting/activity/category-data';
    var ar_save_activity = "https://magicmomentsportal.com/activityreporting/activity/save";
    var ar_choose_custom_activity = "https://magicmomentsportal.com/activityreporting/activity/custom/choose";
    var ar_get_weekly_tracker = "https://magicmomentsportal.com/activityreporting/activity/tracker/weekly";
    var ar_get_dashboard_data = "https://magicmomentsportal.com/activityreporting/activity/dashboard/data";

    var ar_get_filter_report = "https://magicmomentsportal.com/activityreporting/activity/weekly/report/pdf/filter";

    var quiz_default_image = 'https://magicmomentsportal.com/uploads/weeklyquiz/uploads/def_question.png';

    var ar_monthly_report_pdf = 'https://magicmomentsportal.com/activityreporting/activity/tracker/pdf';
    var ar_weekly_report_pdf = 'https://magicmomentsportal.com/activityreporting/activity/weekly/tracker/pdf';

    var ar_dashboard_pdf = 'https://magicmomentsportal.com/activityreporting/activity/dashboard/pdf';
    // Abid 251122 start
    var ar_generate_evidence_pdf = 'https://magicmomentsportal.com/activityreporting/activity/evidence_report_pdf';
    var evidence_one_report_pdf = 'https://magicmomentsportal.com/activityreporting/activity/evidence_one_report_pdf';
    var record_ar_time_url = 'https://magicmomentsportal.com/activityreporting/activity/record_ar_time';
    var module_name = '';
    // Abid 251122 end
    var d = new Date();
    var current_date = d.getFullYear() + "/" + (d.getMonth() + 1) + "/" + d.getDate();
    jQuery(document).ready(function() {
        var record_ar_time = function()
        {
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            $.ajax({
                url:record_ar_time_url,
                type:'POST',
                data:{module_name:module_name},
                success:function(response)
                {
                    var result = jQuery.parseJSON(response);
                }
            });
        }
        record_ar_time();
        // default bachground image
        quiz_src = $("#quiz_image").attr('src');
        if (typeof quiz_src == 'undefined' || quiz_src == false) {
            $(".qcontent").css("background-image", "url(" + quiz_default_image + ")");
            $(".qcontent").css("background-position", "center");
            $("#quiz_image").addClass('d-none');
        }


        var answer = "";
        const answer_ids = [];
        answer = jQuery('#answer').val();
        if (answer != undefined && answer.length > 0) {

            var right_image = "https://magicmomentsportal.com/images/right.png";
            var wrong_image = "https://magicmomentsportal.com/images/wrong.png";

            jQuery(document).on('click', '.quiz-option', function() {

                answer = jQuery('#answer').val();
                var correct_answer = (jQuery('#correct_answers').val() != undefined && jQuery('#correct_answers').val().length > 0) ? jQuery('#correct_answers').val() : 0;
                var wrong_answer = (jQuery('#wrong_answers').val() != undefined && jQuery('#wrong_answers').val().length > 0) ? jQuery('#wrong_answers').val() : 0;

                if (jQuery('#is_competition_quiz').val() !== 'yes') {

                    if (jQuery(this).data('option') == answer) {

                        if (jQuery('#select_answer').attr('data-last-id').length == 0) {

                            jQuery('#select_answer').text('Next');
                            jQuery('#select_answer').css('background-color', 'green');
                            jQuery('#select_answer').attr('id', 'select_next');

                        } else {
                            // update answer box
                            jQuery('#select_answer').attr('id', 'submit_quiz');
                            jQuery('#submit_quiz').text('Submit');
                            jQuery('#submit_quiz').css('background-color', 'green');
                        }

                        // play audio
                        jQuery('#right_audio')[0].play();

                        // for competition quiz only 
                        if (jQuery('#is_competition_quiz').val() == 'yes') {

                            if (jQuery('#answer_updated').val() == '0') {
                                jQuery('#correct_answers').val(parseInt(correct_answer) + 1);
                            }

                        }

                        // refresh options
                        jQuery('.answer_surround .answer_left').each(function() {
                            jQuery(this).css({
                                'background-image': 'none',
                                'background-color': 'white'
                            });
                        });

                        var answer_surround = jQuery(this).closest('.answer_surround');
                        jQuery(answer_surround).find('.answer_left').css({
                            'background-size': 'cover',
                            'background-position': 'center',
                            'background-repeat': 'no-repeat',
                            'background-color': '#e2e2e2',
                            'background-image': `url(${right_image})`
                        });

                    } else {

                        if (jQuery('.qplay').attr('data-last-id').length == 0) {
                            // update submit box
                            jQuery('#select_next').attr('id', 'select_answer');
                            jQuery('#select_answer').text('Select answer');
                            jQuery('#select_answer').css('background-color', '#D93C85');
                        } else {
                            jQuery('#submit_quiz').attr('id', 'select_answer');
                            jQuery('#select_answer').text('Select answer');
                            jQuery('#select_answer').css('background-color', '#D93C85');
                        }

                        // play audio
                        jQuery('#wrong_audio')[0].play();

                        // for competition quiz only 
                        if (jQuery('#is_competition_quiz').val() == 'yes') {
                            if (jQuery('#answer_updated').val() == '0') {
                                jQuery('#wrong_answers').val(parseFloat(wrong_answer) + 0.25);
                            }
                        }

                        // refresh options
                        jQuery('.answer_surround .answer_left').each(function() {
                            jQuery(this).css({
                                'background-image': 'none',
                                'background-color': 'white'
                            });
                        });

                        var answer_surround = jQuery(this).closest('.answer_surround');
                        jQuery(answer_surround).find('.answer_left').css({
                            'background-size': 'cover',
                            'background-position': 'center',
                            'background-repeat': 'no-repeat',
                            'background-color': '#e2e2e2',
                            'background-image': `url(${wrong_image})`
                        });

                    }

                }

                // for competition quiz only 
                if (jQuery('#is_competition_quiz').val() == 'yes') {

                    if (jQuery('#select_answer').length > 0 && jQuery('#select_answer').attr('data-last-id').length == 0) {

                        jQuery('#select_answer').text('Next');
                        jQuery('#select_answer').css('background-color', 'green');
                        jQuery('#select_answer').attr('id', 'select_next');

                    } else {
                        // update answer box
                        jQuery('#select_answer').attr('id', 'submit_quiz');
                        jQuery('#submit_quiz').text('Submit');
                        jQuery('#submit_quiz').css('background-color', 'green');
                    }

                    // play audio ( Not in use )
                    // jQuery('#right_audio')[0].play();

                    // refresh options
                    jQuery('.answer_surround .answer_left').each(function() {
                        jQuery(this).css({
                            'background-image': 'none',
                            'background-color': 'white'
                        });
                    });

                    var answer_surround = jQuery(this).closest('.answer_surround');
                    jQuery(answer_surround).find('.answer_left').css({
                        'background-size': 'cover',
                        'background-position': 'center',
                        'background-repeat': 'no-repeat',
                        'background-color': '#e2e2e2',
                        /*'background-image' :`url(${right_image})`*/
                    });



                    if (jQuery(this).data('option') == answer) {
                        if (jQuery('#answer_updated').val() == '0') {
                            jQuery('#correct_answers').val(parseInt(correct_answer) + 1);
                        }
                    } else {
                        if (jQuery('#answer_updated').val() == '0') {
                            jQuery('#wrong_answers').val(parseFloat(wrong_answer) + 0.25);
                        }
                    }
                    // answer status 
                    jQuery('#answer_updated').val('1');
                }
            });

            /**
             * Load next Question
             */
            jQuery(document).on('click', '#select_next', function() {

                // for competition quiz only 
                if (jQuery('#is_competition_quiz').val() == 'yes') {
                    // answer status
                    jQuery('#answer_updated').val('0');

                }

                var current_id = jQuery('#current_question_id').val();
                var next_id = jQuery(this).attr('data-next-id');
                var question_no = parseInt(jQuery('#question_no').text());
                var table_name = jQuery('#quiz_table').val();

                // update quiz ids array 
                answer_ids.push(current_id);

                $.ajaxSetup({
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    }
                });

                $.ajax({
                    type: 'POST',
                    url: get_quiz_data,
                    dataType: 'JSON',
                    data: {
                        'next_id': next_id,
                        'table_name': table_name
                    },
                    success: function(data) {
                        if (data.success == true) {
                            var quiz_data = Object.values(data.quiz_data);
                            var current_quiz = quiz_data[0];
                            var next_quiz = quiz_data[1];

                            // change heading
                            jQuery('.quiz-heading').text(current_quiz['question']);

                            // refresh options
                            jQuery('.answer_surround .answer_left').each(function() {
                                jQuery(this).css({
                                    'background-image': 'none',
                                    'background-color': 'white'
                                });
                            });

                            // option A
                            jQuery('#option_a').text(current_quiz['option_a']);
                            // option B
                            jQuery('#option_b').text(current_quiz['option_b']);
                            // option C
                            jQuery('#option_c').text(current_quiz['option_c']);

                            // udpate answers 
                            jQuery('#answer').val(current_quiz['answers']);

                            // update question no
                            jQuery('#question_no').text(++question_no);

                            var uploads_dir_url = data.table;
                            var images_dir_url = "https://magicmomentsportal.com/images";

                            jQuery('#quiz_preview').find('#audio_player').remove();

                            var preview = '';

                            if (current_quiz['mime_type'] == "mp4") {
                                var quiz_image_url = images_dir_url + '/_video_play.png';
                                var preview = `preview_custom_video('${uploads_dir_url+'/'+current_quiz['image_source']}')`;
                                var video_url = uploads_dir_url + '/' + current_quiz['image_source'];

                                jQuery('#quiz_video').removeClass('d-none');
                                jQuery('#quiz_video').attr('src', video_url);

                                jQuery('#quiz_image').addClass('player-image-center');
                                jQuery('#quiz_image').removeClass('quiz_audio-icon');
                                jQuery('#quiz_image').addClass('quiz_play-icon');

                                // ma
                                $(".qcontent").removeAttr("style");
                                $("#quiz_image").removeClass('d-none');

                            } else if (current_quiz['mime_type'] == "mp3") {

                                var quiz_image_url = images_dir_url + '/audio_clip_play.png';
                                // var preview = `preview_audio('${uploads_dir_url+'/'+current_quiz['image_source']}', '${quiz_image_url}')`;
                                var audio_preview = `<audio controls="" class="audio-controls" id="audio_player">
                                        <source src="${uploads_dir_url+'/'+current_quiz['image_source']}" type="audio/mpeg">
                                        Your browser does not support the video tag.
                                    </audio>`;
                                jQuery('#quiz_video').addClass('d-none');
                                jQuery('#quiz_image').addClass('player-image-center');
                                jQuery('#quiz_image').addClass('quiz_audio-icon');
                                jQuery('#quiz_image').removeClass('quiz_play-icon');

                                jQuery('#quiz_preview').find('#audio_player').remove();
                                jQuery('#quiz_preview').append(audio_preview);

                                preview = 'play_audio(this)';

                                //ma
                                $(".qcontent").removeAttr("style");
                                $("#quiz_image").removeClass('d-none');

                            } else {

                                var quiz_image_url = (current_quiz['attachment_id'] != null) ? uploads_dir_url + "/" + current_quiz['image_source'] : '';
                                var preview = `preview_image('${quiz_image_url}')`;
                                jQuery('#quiz_video').addClass('d-none');

                                //ma
                                $(".qcontent").css("background-image", "");
                                $(".qcontent").css("background-position", "");

                                jQuery('#quiz_image').removeClass('quiz_play-icon');
                                jQuery('#quiz_image').removeClass('quiz_audio-icon');
                            }

                            // update image
                            if (current_quiz['attachment_id'] != null) {
                                jQuery('#quiz_image').attr('src', quiz_image_url);
                                jQuery('#quiz_image').attr('onclick', preview);
                                $("#quiz_image").removeClass('d-none');
                            } else {
                                $(".qcontent").css("background-image", "url(" + quiz_default_image + ")");
                                $(".qcontent").css("background-position", "center");
                                $("#quiz_image").addClass('d-none');
                            }

                            // change current quiz id 
                            jQuery('#current_question_id').val(next_id);

                            if (quiz_data.length > 1) {

                                // update answer box
                                jQuery('#select_next').attr('id', 'select_answer');
                                jQuery('#select_answer').text('Select answer');
                                jQuery('#select_answer').css('background-color', '#D93C85');

                                // update next quiz id
                                jQuery('#select_answer').attr('data-next-id', next_quiz['id']).trigger("refresh");

                            } else {

                                // update answer box
                                jQuery('#select_next').attr('id', 'select_answer');
                                jQuery('#select_answer').text('Select answer');
                                jQuery('#select_answer').css('background-color', '#D93C85');

                                // // update answer box
                                // jQuery('#select_next').attr('id', 'submit_quiz');
                                // jQuery('#submit_quiz').text('Submit');
                                // jQuery('#submit_quiz').css('background-color', 'green');
                                jQuery('.qplay').attr('data-last-id', current_quiz['id']);
                            }

                        }
                    },
                    error: function(data) {}
                });

            });

            /**
             * Competition Quiz Time
             */
            if (jQuery('#quiz_clock').length > 0) {

                var initMinutes = 0;

                var timer = new Timer("quiz_clock", initMinutes);
                timer.start();


            }

            /**
             * On quiz submit
             */
            jQuery(document).on('click', '#submit_quiz', function() {

                // for competition quiz only 
                if (jQuery('#is_competition_quiz').val() == 'yes') {

                    var current_time = "1675765108";

                    jQuery('#end_time').val(current_time);

                    var current_id = jQuery('#current_question_id').val();

                    // update quiz ids array 
                    answer_ids.push(current_id);

                    // prepare quiz result data 

                    var start_time = jQuery('#start_time').val();
                    var end_time = jQuery('#end_time').val();
                    var correct_answers = jQuery('#correct_answers').val();
                    var wrong_answers = jQuery('#wrong_answers').val();
                    var quiz_no = jQuery('#quiz_no').val();
                    var user_id = jQuery('#user_id').val();
                    var home_id = jQuery('#home_id').val();
                    var quiz_clock = jQuery('#quiz_clock').text();

                    $.ajax({
                        type: 'POST',
                        url: update_quiz_result,
                        dataType: 'JSON',
                        data: {
                            'start_time': start_time,
                            'end_time': end_time,
                            'correct_answers': correct_answers,
                            'wrong_answers': wrong_answers,
                            'quiz_no': quiz_no,
                            'user_id': user_id,
                            'home_id': home_id,
                            'quiz_clock': quiz_clock,
                            'answer_ids': answer_ids,
                            'last_question_id': current_id
                        },
                        success: function(data) {
                            if (data.success == true) {
                                window.location = competition_congratulations;
                            }
                        },
                        error: function(data) {}
                    });

                } else {
                    window.location = congratulations;
                }

            });

        }

        $('.select2').select2();
        $('.datepicker').datepicker({
            clearBtn: true
        });
        $('.timepicker').timepicker({
            showMeridian: false
        });
    });


    // click image play audio

    function play_audio(element) {

        audio = $(element).closest("#quiz_preview").find("#audio_player");

        if (audio[0].paused) {
            audio[0].play();
            // $(element).closest("#quiz_preview").find('.quiz_audio-icon').attr('src', 'images/audio_clip_play.png');
        } else {
            audio[0].pause();
            // $(element).closest("#quiz_preview").find('.quiz_audio-icon').src('src', 'images/back_but.png');
        }

    }

    /**
     *  Preview video
     */
    function preview_video(url_id) {
        Swal.fire({
            title: '',
            width: '50%',
            html: `
                <div class="iframe-container"><!--<a id="expand_popup" onclick="$('.swal2-popup.swal2-modal.swal2-show').toggleClass('popup-expanded');$('#expand_popup').toggleClass('contracted');"></a>--><iframe class="responsive-iframe" src="https://www.youtube.com/embed/${url_id}?autoplay=1&rel=0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                `,
            footer: `<div style="position:relative;width:100%;"><span> Magic Moments </span><a href="javascript:void(0)" id="close_popup" onclick="swal.close(); return false;"></a></div>`,
            customClass: {
                cancelButton: 'btn btn-danger'
            },
            showCancelButton: false,
            showConfirmButton: false,
            cancelButtonText: 'Close',
            cancelButtonColor: '#5EC4E0',
            confirmButtonColor: '#D93C85',
            confirmButtonText: `Upload`,
            closeOnConfirm: false,
            onClose: refreshCarousel
        })
    }







    /**
     *  Preview audio/mp3
     */
    function preview_audioMp3nBg(componentID) {
		
		//audioFileSource
		
        //audioMp3Src, bgImage
        //var jsonToVar = JSON.parse(audioFileSource);

        //var audioMp3Src = jsonToVar.file_path;
        //var bgImage = jsonToVar.bg_image;

        //alert(audioMp3Src);
		
		var audioMp3Src = jQuery('#component_audio_file_path_'+componentID).val();
		var bgImage = jQuery('#component_audio_bg_image_'+componentID).val();
		
		//alert(audioMp3Src);alert(bgImage);
		
        Swal.fire({
            title: '',
            width: '50%',
            html: `
                <!--<a id="expand_popup" onclick="$('.swal2-popup.swal2-modal.swal2-show').toggleClass('popup-expanded');$('#expand_popup').toggleClass('contracted');"></a>--><div class="audioPlayer" style="position: relative; width: 100%;  min-height: 500px;  background-image: url('${bgImage}'); background-size: 75%;  background-position: top center; background-repeat: no-repeat;"><audio autoplay controls = 'controls' style="position: absolute; bottom: 0; left: 0; width: 100%;"><source src='${audioMp3Src}' type= 'audio/mp3'></audio></div>`,
            footer: `<div style="position:relative;width:100%;"><span> Magic Moments </span><a href="javascript:void(0)" id="close_popup" onclick="swal.close(); return false;"></a></div>`,

            customClass: {
                cancelButton: 'btn btn-danger'
            },
            showCancelButton: false,
            showConfirmButton: false,
            cancelButtonText: 'Close',
            cancelButtonColor: '#5EC4E0',
            confirmButtonColor: '#D93C85',
            confirmButtonText: `Upload`,
            closeOnConfirm: false,
            onClose: refreshCarousel
        })
    }








    function refreshCarousel() {
        $('.owl-thumbnail-carousel').trigger('refresh.owl.carousel');
    }

    /**
     *  Preview Custom Video
     */
    function preview_custom_video(video_url) {
        console.log(video_url);
        // document.getElementById("id_of_the_video").play();

        Swal.fire({
            title: '',
            width: '50%',
            html: `
                <!--<a id="expand_popup" onclick="$('.swal2-popup.swal2-modal.swal2-show').toggleClass('popup-expanded');$('#expand_popup').toggleClass('contracted');"></a>--><video controls autoplay="autoplay"><source src="${video_url}" type="video/mp4"></video>`,
            footer: `<div style="position:relative;width:100%;"><span> Magic Moments </span><a href="javascript:void(0)" id="close_popup" onclick="swal.close(); return false;"></a></div>`,
            customClass: {
                cancelButton: 'btn btn-danger'
            },
            showCancelButton: false,
            showConfirmButton: false,
            cancelButtonText: 'Close',
            cancelButtonColor: '#5EC4E0',
            confirmButtonColor: '#D93C85',
            confirmButtonText: `Upload`,
            closeOnConfirm: false
        })
    }

    /**
     *  Preview video
     */
    function preview_vimeo_video(url) {
        Swal.fire({
            title: '',
            width: '50%',
            html: `
                <div class="iframe-container"><!--<a id="expand_popup" onclick="$('.swal2-popup.swal2-modal.swal2-show').toggleClass('popup-expanded');$('#expand_popup').toggleClass('contracted');"></a>--><iframe class="responsive-iframe" src="${url}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`,
            footer: `<div style="position:relative;width:100%;"><span> Magic Moments </span><a href="javascript:void(0)" id="close_popup" onclick="swal.close(); return false;"></a></div>`,
            customClass: {
                cancelButton: 'btn btn-danger'
            },
            showCancelButton: false,
            showConfirmButton: false,
            cancelButtonText: 'Close',
            cancelButtonColor: '#5EC4E0',
            confirmButtonColor: '#D93C85',
            confirmButtonText: `Upload`,
            closeOnConfirm: false,
            onClose: refreshCarousel
        })
    }

    /**
     *  Preview video
     */
    function preview_vimeo_video(url) {
        Swal.fire({
            title: '',
            width: '50%',
            html: `
                <div class="iframe-container"><!--<a id="expand_popup" onclick="$('.swal2-popup.swal2-modal.swal2-show').toggleClass('popup-expanded');$('#expand_popup').toggleClass('contracted');"></a>--><iframe class="responsive-iframe" src="${url}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>
                `,
            footer: `<div style="position:relative;width:100%;"><span> Magic Moments </span><a href="javascript:void(0)" id="close_popup" onclick="swal.close(); return false;"></a></div>`,
            customClass: {
                cancelButton: 'btn btn-danger'
            },
            showCancelButton: false,
            showConfirmButton: false,
            cancelButtonText: 'Close',
            cancelButtonColor: '#5EC4E0',
            confirmButtonColor: '#D93C85',
            confirmButtonText: `Upload`,
            closeOnConfirm: false,
            onClose: refreshCarousel
        })
    }

    /**
     *  Preview Custom Audio
     */
    function preview_audio(audio_url, image_url) {
        Swal.fire({
            title: '',
            width: '50%',
            html: `<div class="image-container" style="text-align: center;"><img src="${image_url}" class="img-fluid previewed-image" onclick="toggleFullscreen(this)"/></div>
                <!--<a id="expand_popup" onclick="$('.swal2-popup.swal2-modal.swal2-show').toggleClass('popup-expanded');$('#expand_popup').toggleClass('contracted');"></a>--><audio autoplay controls style="width:100%;"><source src="${audio_url}" type="audio/mpeg"></audio>`,
            footer: `<div style="position:relative;width:100%;"><span> Magic Moments </span><a href="javascript:void(0)" id="close_popup" onclick="swal.close(); return false;"></a></div>`,
            customClass: {
                cancelButton: 'btn btn-danger'
            },
            showCancelButton: false,
            showConfirmButton: false,
            cancelButtonText: 'Close',
            cancelButtonColor: '#5EC4E0',
            confirmButtonColor: '#D93C85',
            confirmButtonText: `Upload`,
            closeOnConfirm: false
        })
    }

    /** 
     * Time for Competition Quiz
     */
    function Timer(clockID, initValue) {

        this.minutes = initValue;

        this.seconds = initValue * 60;

        this.clockElement = document.getElementById(clockID);

        this.decrement = function() {

            if (this.seconds < 59) {
                // this.secondElement.value = this.seconds;
                this.clockElement.innerHTML = "00:" + ('0' + this.seconds).slice(-2);

            } else {
                this.clockElement.innerHTML = this.getMinutes() + ":" + ('0' + this.getSeconds()).slice(-2);
            }

            this.seconds++;
            setTimeout(this.decrement.bind(this), 1000);

        };

        this.getMinutes = function() {
            this.minutes = ('0' + Math.floor(this.seconds / 60)).slice(-2);
            return this.minutes;
        };

        this.getSeconds = function() {
            return this.seconds - Math.round(this.minutes * 60);
        };

        this.start = function() {
            this.decrement();
        };

        return this;
    }


    jQuery(document).ready(function() {

        jQuery(document).on('click', '#swal_close_button', function() {

            Swal.close()

        });
    });

    /**
     *  Preview Image
     */
    function preview_image(image_url) {
        var close_btn = "https://magicmomentsportal.com/images/close2.png";
        Swal.fire({
            title: '',
            html: `
                <div class="image-container"><img src="${image_url}" class="img-fluid previewed-image" onclick="toggleFullscreen(this)"/></div>
                `,
            footer: `<span> Magic Moments </span> <button type="button" role="button" tabindex="0" id="swal_close_button" class="customSwalBtn"><img src="${close_btn}" height="30" width="30"/></button>`,
            customClass: {
                cancelButton: 'btn btn-danger'
            },
            showCancelButton: false,
            showConfirmButton: false,
            cancelButtonText: 'Close',
            cancelButtonColor: '#5EC4E0',
            confirmButtonColor: '#D93C85',
            confirmButtonText: `Upload`,
            closeOnConfirm: false
        })
    }

    function toggleFullscreen(elem) {
        elem = elem || document.documentElement;
        if (!document.fullscreenElement && !document.mozFullScreenElement &&
            !document.webkitFullscreenElement && !document.msFullscreenElement) {
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            } else if (elem.mozRequestFullScreen) {
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT);
            }
        } else {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            } else if (document.mozCancelFullScreen) {
                document.mozCancelFullScreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            }
        }
    }
</script>

<!-- Owl Carousel -->
<script>
    var current_index = "1";
    var pageCarousel = $('.owl-carousel').owlCarousel({
        loop: false,
        margin: 10,
        nav: true,
        startPosition: parseInt(current_index) - 1,
        navText: [`<div class="owl-navigations"> 
                            <button type="button" role="presentation" class="owl-btn" href="#carouselExampleControls" role="button" data-slide="prev"> <img src="https://magicmomentsportal.com/images/slide_prev.png" alt="" width="90" height="150"> </button> 
                        </div>`, `<div class="owl-navigations"> 
                            <button type="button" role="presentation" class="owl-btn" href="#carouselExampleControls" role="button" data-slide="next"> <img src="https://magicmomentsportal.com/images/slide_next.png" alt=""  width="90" height="150"> </button> 
                        </div>`],
        responsive: {
            0: {
                items: 1
            },
            600: {
                items: 1
            },
            1000: {
                items: 1
            },
            1200: {
                items: 1
            },
        }
    });

    var owl = $('.owl-thumbnail-carousel');
    owl.owlCarousel({
        items: 3,
        loop: true,
        margin: 10,
        autoplay: true,
        autoplayTimeout: 3000,
        autoplayHoverPause: true
    });

    // jQuery method on
    owl.on('changed.owl.carousel', function(property) {

        var current = property.item.index;
        current = parseInt(current) + 1;
        var src = $(property.target).find(".owl-item").eq(current).find("img").attr('src');
        var title = $(property.target).find(".owl-item").eq(current).find("li").data('video-title');
        var video_id = $(property.target).find(".owl-item").eq(current).find("li").data('video-id');
        $(property.target).find(".owl-item").find("li").css({
            'border-color': 'white'
        });
        var currentBorder = $(property.target).find(".owl-item").eq(current).find("li").css({
            'border-color': '#D93C85'
        });

        var thumbnail_preview = $(property.target).closest(".thumbnail-carousel-container").find('img.thumbnail-preview');
        $(thumbnail_preview).attr('src', src);
        // $(thumbnail_preview).attr('onclick', `preview_image('${src}')`);

        // for stories
        if (video_id != '') {
            var video_preview = $(property.target).closest(".thumbnail-carousel-container").find('img.story-thumbnail-play-button').removeClass("d-none");
            $(video_preview).attr('onclick', `preview_video('${video_id}')`);
        } else if (src != '') {

            var image_preview = $(property.target).closest(".thumbnail-carousel-container").find('img.story-thumbnail-preview');
            $(image_preview).attr('onclick', `preview_image('${src}')`);

            var video_preview = $(property.target).closest(".thumbnail-carousel-container").find('img.story-thumbnail-play-button').addClass("d-none");
        }
        // end stories

        var video_preview = $(property.target).closest(".thumbnail-carousel-container").find('img.thumbnail-play-button');
        $(video_preview).attr('onclick', `preview_video('${video_id}')`);

        var image_title = $(property.target).closest(".thumbnail-carousel-container").find('div.img-title');
        $(image_title).text(title);
    });

    $('.owl-thumbnail-carousel').on('click', '.owl-item', function() {

        $(".owl-item").closest('.owl-thumbnail-carousel').find("li").css({
            'border-color': 'white'
        });
        var currentBorder = $(this).find("li").css({
            'border-color': '#D93C85'
        });

        var src = jQuery(this).find("img").attr("src");
        var title = jQuery(this).find("li").data('video-title');
        var video_id = jQuery(this).find("li").data('video-id');

        // for stories
        if (video_id != '') {
            var video_preview = $(this).closest(".thumbnail-carousel-container").find('img.story-thumbnail-play-button').removeClass("d-none");
            $(video_preview).attr('onclick', `preview_video('${video_id}')`);
        } else if (src != '') {

            var image_preview = $(this).closest(".thumbnail-carousel-container").find('img.story-thumbnail-preview');
            $(image_preview).attr('onclick', `preview_image('${src}')`);

            var video_preview = $(this).closest(".thumbnail-carousel-container").find('img.story-thumbnail-play-button').addClass("d-none");
        }
        // end stories

        var thumbnail_preview = jQuery(this).closest(".thumbnail-carousel-container").find('img.thumbnail-preview');
        $(thumbnail_preview).attr('src', src);
        // $(thumbnail_preview).attr('onclick', `preview_image('${src}')`); not in use

        var video_preview = jQuery(this).closest(".thumbnail-carousel-container").find('img.thumbnail-play-button');
        $(video_preview).attr('onclick', `preview_video('${video_id}')`);

        var image_title = jQuery(this).closest(".thumbnail-carousel-container").find('div.img-title');
        $(image_title).text(title);

        owl.trigger('stop.owl.autoplay');

    })

    $('.thumbnail-play-button').on('click', function() {

        if ($(this).data('status') == "pause") {

            owl.trigger('play.owl.autoplay', [1000])

        }

        if ($(this).data('status') == "play") {

            owl.trigger('stop.owl.autoplay')

        }

    })

    $(document).on('click', '.two-item-owl', function() {

        $(".two-item-owl").css({
            'border-color': 'white'
        });
        var currentBorder = $(this).css({
            'border-color': '#D93C85'
        });

        var src = jQuery(this).find("img").attr("src");
        var title = jQuery(this).data('video-title');
        var video_id = jQuery(this).data('video-id');

        var thumbnail_preview = jQuery(this).closest(".thumbnail-carousel-container").find('img.thumbnail-preview');
        $(thumbnail_preview).attr('src', src);
        // $(thumbnail_preview).attr('onclick', `preview_image('${src}')`); not in use

        var video_preview = jQuery(this).closest(".thumbnail-carousel-container").find('img.thumbnail-play-button');
        $(video_preview).attr('onclick', `preview_video('${video_id}')`);

        var image_title = jQuery(this).closest(".thumbnail-carousel-container").find('div.img-title');
        $(image_title).text(title);

    });


    // $('.stop').on('click', function() {
    //     owl.trigger('stop.owl.autoplay')
    // })

    // Owl carousel
    // pageCarousel.on('changed.owl.carousel',function(property){
    //     // $('.owl-thumbnail-carousel').trigger('refresh.owl.carousel');
    // });

    /**
     *  User Activity Log
     */
    function user_states(actionType) {

        var activity_page = jQuery("title").text();
        var action = 'Browse';
        var action_details = null;
        var link_visit = "https://magicmomentsportal.com/section/toolkit/templates-stationery/together-templates?pages[0]=36&pages[1]=38";
        var action_type = actionType;

        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        $.ajax({
            type: 'POST',
            url: update_user_activity,
            dataType: 'JSON',
            data: {
                activity_page: activity_page,
                action: action,
                action_details: action_details,
                action_url_name: link_visit,
                action_type: action_type
            },
            success: function(result) {
                console.log(result)
            },
            error: function(error) {}
        });
    }

    /**
     *  Not in use for now
     */
    // $(function(){
    //     user_states('NewEntry');
    // })

    // setInterval(function () {
    //     user_states('SamePage');
    // }, 10000)
</script>

<script>
    /**
     * getImagePreview
     *
     * @return void
     */
    function getImagePreview(element) {
        const file = element.files[0];

        image_type = ['image/png', 'image/avif', 'image/gif', 'image/jpeg', 'image/png', 'image/svg+xml', 'image/webp', 'png', 'jpeg', 'jpg', 'svg+xml', 'webp'];
        video_type = ['video/mp4', 'video/mkv', 'video/webm', 'mp4', 'mkv', 'webm'];

        if (file) {
            let reader = new FileReader();

            if (jQuery.inArray(file.type, image_type) != -1) {

                console.log("Image");

                reader.onload = function(event) {

                    $(element).closest('div').find('img.preview-image').removeClass("d-none");
                    $(element).closest('div').find('video.videoViewer').addClass("d-none");
                    $(element).closest('div').find('video.videoViewer').attr('src', "");
                    $(element).closest('div').find('img.preview-image').attr('src', event.target.result);
                    $(element).closest('div').find('.remove-preview-btn').removeClass("d-none");

                    // story title required
                    $(element).closest("div").find(".attachment_title").prop("required", true);
                }
                reader.readAsDataURL(file);

            } else if (jQuery.inArray(file.type, video_type) != -1) {

                console.log("Video");

                reader.onload = function(event) {

                    $(element).closest('div').find('video.videoViewer').removeClass("d-none");
                    $(element).closest('div').find('video.videoViewer').attr('src', event.target.result);
                    $(element).closest('div').find('img.preview-image').addClass("d-none");
                    $(element).closest('div').find('img.preview-image').attr('src', "");
                    $(element).closest('div').find('.remove-preview-btn').removeClass("d-none");

                    // story title required
                    $(element).closest("div").find(".attachment_title").prop("required", true);
                }
                reader.readAsDataURL(file);

            } else {

                console.log("Nothing");

                $(element).closest('div').find('img.preview-image').attr("src", "https://img.icons8.com/ultraviolet/344/cloud-file.png");
                $(element).closest('div').find('video.videoViewer').addClass("d-none");
                $(element).closest('div').find('.remove-preview-btn').addClass("d-none");

                // story title not required
                $(element).closest("div").find(".attachment_title").prop("required", false);

                return;
            }
        } else {
            $(element).closest('div').find('.remove-preview-btn').addClass("d-none");

            // story title not required
            $(element).closest("div").find(".attachment_title").prop("required", false);

        }

    }

    /**
     * Remove Preview
     */
    function remove_preview(element) {

        console.log("Removing Preview");
        $(element).closest('.userfile').find('input.attachment_upload').val("");

        $(element).closest('div.upload_file').find('img.preview-image').removeClass("d-none");
        $(element).closest('div.upload_file').find('img.preview-image').attr("src", "https://img.icons8.com/ultraviolet/344/cloud-file.png");
        $(element).closest('div.upload_file').find('video.videoViewer').attr('src', "");
        $(element).closest('div.upload_file').find('video.videoViewer').addClass("d-none");
        $(element).closest('div.upload_file').find('.remove-preview-btn').addClass("d-none");


        // story title not required
        $(element).closest("div.userfile").find(".attachment_title").prop("required", false);
    }
</script>

<script>
    /**
     *  Logout if no activity after 15 minutes
     */
    $(document).ready(function() {
        const timeout = 900000; // 900000 ms = 15 minutes
        var idleTimer = null;
        $('*').bind('mousemove click mouseup mousedown keydown keypress keyup submit change mouseenter scroll resize dblclick', function() {
            clearTimeout(idleTimer);

            idleTimer = setTimeout(function() {
                // document.getElementById('logout-form').submit();
                window.location.href = "https://magicmomentsportal.com/admin/logout"
            }, timeout);
        });
        $("body").trigger("mousemove");
    });
</script>


<script>
    var event_categories = '';
    var created_by = 'angie.robertson';

    var select_categories = '<select class="form-control select-category">';
    select_categories += `<option value="">Select Category</option>`;

    if (event_categories.length > 0) {
        event_categories = $.parseJSON(event_categories);
        $.each(event_categories, function(index, element) {

            select_categories += `<option value="${element.id}">` + element.name + '</option>';
        });
    }
    select_categories += '</select>';

    /**
     *  Frontend scripts
     */
    $('#activity_add_row').click(function() {

        row_data = `
                <tr>
                    <td class="activity-name-box"> <input type="text" class="form-control activity-name" /> </td>
                    <td class="activity-category-box"> ${select_categories} </td>
                    <td class="activity-mbs-box"></td>
                    <td class="activity-toggle-box"> 
                        <label class="switch">
                        <input type="checkbox" class="activity-status">
                        <span class="slider round"></span>
                        </label>
                    </td>
                    <td class="activity-creater-box"> ${created_by} </td>
                    <td class="activity-action-box"><button type="button" data-edit_url="#" class="btn btn-info save_activity">Save</button></td>
                </tr>`;

        $('#custom_activity_table_body').prepend(row_data);

    });

    $(document).on('click', '.save_activity', function() {

        var activity_box = $(this).closest('tr').find('td.activity-name-box').find('.activity-name').val();
        var category_box = $(this).closest('tr').find('td.activity-category-box').find('.select-category').val();
        // var activity_status = $(this).closest('tr').find('td.activity-toggle-box').find('.activity-status').val();

        if ($(this).closest('tr').find('td.activity-toggle-box').find('.activity-status').is(":checked")) {
            activity_status = '1';
        } else {
            activity_status = '0';
        }

        var activity_id = $(this).closest('tr').data('activity-id');

        if (activity_box.length == 0 || category_box.length == 0) {

            jQuery('.main-heading').addClass('text-danger');
            jQuery('.main-heading').text('Please fill in all required fields');

            return;
        }

        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        $.ajax({
            type: 'POST',
            url: ar_save_activity,
            dataType: 'JSON',
            data: {
                id: activity_id,
                name: activity_box,
                category: category_box,
                status: activity_status
            },
            beforeSend: function() {
                $('#loader').show();
            },
            success: function(result) {
                if (result.success) {
                    $('#loader').hide();
                    location.reload();
                }
            },
            error: function(error) {
                $('#loader').hide();
            }
        });

    });

    $(document).on('click', '.choose_custom_activity', function() {

        var activity_id = $(this).data('activity-id');
        var go_back = $('#go_back').val();

        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        $.ajax({
            type: 'POST',
            url: ar_choose_custom_activity,
            dataType: 'JSON',
            data: {
                activity_id: activity_id,
                go_back: go_back,
            },
            beforeSend: function() {
                $('#loader').show();
            },
            success: function(result) {
                if (result.success) {
                    $('#loader').hide();
                    window.location.href = result.route;
                }
            },
            error: function(error) {
                $('#loader').hide();
            }
        });

    });


    $(document).ready(function() {

        $('#ar_select_category').select2({
            placeholder: "Select Category",
        });

        $('#activity_id').select2({
            placeholder: "Select Activity"
        });

    });

    /**
     *  On change select2
     */
    $(document).on('change', '.select-category', function() {

        var category_id = $(this).val();

        $('#loader').show();

        var element = $(this);
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        $.ajax({
            type: 'POST',
            url: get_category_data,
            dataType: 'JSON',
            data: {
                category_id: category_id,
            },
            success: function(result) {
                if (result.success) {

                    var mbs = result.message;
                    $(element).closest('tr').find('td.activity-mbs-box').text(mbs);
                    $('#loader').hide();
                }
            },
            error: function(error) {}
        });

    });

    /**
     * removeActvity
     *
     * @return void
     */
    function removeActivity(id, element) {

var remove_activity_url = 'https://magicmomentsportal.com/activityreporting/activity/delete';

$.ajaxSetup({
    headers: {
        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
    }
});

Swal.fire({
    title: 'Do you really want to delete?',
    showDenyButton: true,
    showCancelButton: false,
    confirmButtonText: `Yes`,
    denyButtonText: `No`,
}).then((result) => {
    if (result.isConfirmed) {
        $.ajax({
            type: 'POST',
            url: remove_activity_url,
            dataType: 'JSON',
            data: {
                id: id,
            },
            beforeSend: function() {
                $('#loader').show();
            },
            success: function(result) {
                if (result.success) {
                    $('#loader').hide();
                    $(element).closest('tr').remove();
                }
            },
            error: function(error) {
                $('#loader').hide();
            }
        });
    }
});

}

    /**
     * updateActivityStatus
     *
     * @return void
     */
    function updateActivityStatus(id, element) {

        var update_activity_status = 'https://magicmomentsportal.com/activityreporting/activity/update/status';

        var activity_id = $(element).closest('tr').attr('data-activity-id');

        if ($(element).is(":checked")) {
            activity_status = '1';
        } else {
            activity_status = '0';
        }



        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        // Swal.fire({
        //     title: 'Do you sure?',
        //     showDenyButton: true,
        //     showCancelButton: false,
        //     confirmButtonText: `Yes`,
        //     denyButtonText: `No`,
        // }).then((result) => {
        //     if (result.isConfirmed) {
                $.ajax({
                    type: 'POST',
                    url: update_activity_status,
                    dataType: 'JSON',
                    data: {
                        id: activity_id,
                        status: activity_status,
                    },
                    // beforeSend: function() {
                    //     $('#loader').show();
                    // },
                    success: function(result) {
                        if (result.success) {
                            $('#loader').hide();
                        }
                    },
                    error: function(error) {
                        $('#loader').hide();
                    }
                });
        //     }
        // });

    }

    /**
     *  On Edit Activity
     */
    $(document).on('click', '.edit_activity', function() {

        $(this).closest('tr').find('td.activity-name-box').find('.activity-name').prop('disabled', false);
        $(this).closest('tr').find('td.activity-category-box').find('.select-category').prop('disabled', false);

        $(this).closest('tr').find('td.activity-name-box').find('.activity-name').removeClass('ar-input-disabled');
        $(this).closest('tr').find('td.activity-category-box').find('.select-category').removeClass('ar-select-disabled');


        var save_button = '<button type="button" data-edit_url="#" class="btn btn-info save_activity">Save</button>';
        $(this).closest('tr').find('td.activity-action-box').empty().html(save_button);
    });

    var remove_resident = 'https://magicmomentsportal.com/images/del.png';

    /**
     *  Drag and Drop
     */
    $("document").ready(function() {

        make_elements_dragable();

        $(document).on('click', '.move-resident-cursor', function() {

            var parent_li = $(this).closest('li.move-resident').clone();

            $("#storetank").append(parent_li);
            $(parent_li).find('img').attr('src', remove_resident);
            $(parent_li).find('a').addClass('remove-resident');
            $(parent_li).removeClass('drag-resident');

            $(parent_li).attr("style", "");

            $(this).closest('li.move-resident').remove();

            var resident_id = $(this).attr('data-resident-id');
            ar_add_new_record(resident_id);

        });

    });

    function make_elements_dragable() {

        $(".drag-resident").draggable({
            helper: 'clone',
            revert: 'invalid',
            appendTo: 'body',
            cursor: "move",
            containment: "document",
            zIndex: 10000,
            scroll: false,
            start: function(event, ui) {
                $(this).addClass('move-resident');

                $("body").attr("style", "");
            },

        });

        $("#storetank").droppable({
            accept: '.drag-resident',
            drop: function(event, ui) {
                $(this).append($(ui.draggable));
                $(ui.draggable).find('img').attr('src', remove_resident);
                $(ui.draggable).find('a').addClass('remove-resident');
                $(ui.draggable).removeClass('drag-resident');

                $(ui.draggable).attr("style", "");

                var resident_id = $(ui.draggable).attr('data-resident-id');
                ar_add_new_record(resident_id);
            }
        });

    }

    $(document).ready(function() {

        ar_restrict_past_dates();


        $('#activity_coordinators').select2({
            placeholder: "Select Host / Coordinator",
            allowClear: true
        });

        $('#ar_back_activity').hide();

        $('#ar_proceed_activity').click(function() {

            // validation

            if ($('#activity_id').val().length == 0) {


                jQuery('.mma_box').css({
                    'border': '1px solid rgb(217, 60, 133)'
                });

                jQuery('#activity_id').closest('.mma_box').css({
                    'border': '5px solid rgb(217, 60, 133)'
                });
                jQuery('.main-heading').addClass('text-danger');
                jQuery('.main-heading').text('Please fill in all required fields');

                return;
            }

            if ($('#activity_coordinators').val().length == 0 && $('#other_name').val().length == 0) {

                jQuery('.mma_box').css({
                    'border': '1px solid rgb(217, 60, 133)'
                });

                jQuery('#activity_coordinators').closest('.mma_box').css({
                    'border': '5px solid rgb(217, 60, 133)'
                });
                jQuery('.main-heading').addClass('text-danger');
                jQuery('.main-heading').text('Please fill in all required fields');

                return;
            }

            if ($('#activity_start_time').val().length == 0) {

                jQuery('.mma_box').css({
                    'border': '1px solid rgb(217, 60, 133)'
                });

                jQuery('#activity_start_time').closest('.mma_box').css({
                    'border': '5px solid rgb(217, 60, 133)'
                });
                jQuery('.main-heading').addClass('text-danger');
                jQuery('.main-heading').text('Please fill in all required fields');

                return;
            }

            if ($('#activity_end_time').val().length == 0) {

                jQuery('.mma_box').css({
                    'border': '1px solid rgb(217, 60, 133)'
                });

                jQuery('#activity_end_time').closest('.mma_box').css({
                    'border': '5px solid rgb(217, 60, 133)'
                });
                jQuery('.main-heading').addClass('text-danger');
                jQuery('.main-heading').text('Please fill in all required fields');

                return;
            }

            if ($('#activity_date').val().length == 0) {

                jQuery('.mma_box').css({
                    'border': '1px solid rgb(217, 60, 133)'
                });

                jQuery('#activity_date').closest('.mma_box').css({
                    'border': '5px solid rgb(217, 60, 133)'
                });
                jQuery('.main-heading').addClass('text-danger');
                jQuery('.main-heading').text('Please fill in all required fields');

                return;
            }

            if ($('#activity_experience').val().length == 0) {

                jQuery('.mma_box').css({
                    'border': '1px solid rgb(217, 60, 133)'
                });

                jQuery('#activity_experience').closest('.mma_box').css({
                    'border': '5px solid rgb(217, 60, 133)'
                });
                jQuery('.main-heading').addClass('text-danger');
                jQuery('.main-heading').text('Please fill in all required fields');

                return;
            }

            if ($('#activity_feedback').val().length == 0) {

                jQuery('.mma_box').css({
                    'border': '1px solid rgb(217, 60, 133)'
                });

                jQuery('#activity_feedback').closest('.mma_box').css({
                    'border': '5px solid rgb(217, 60, 133)'
                });
                jQuery('.main-heading').addClass('text-danger');
                jQuery('.main-heading').text('Please fill in all required fields');

                jQuery('.character_error').show();

                return;
            }

            if ($('#storetank').find('li').length == 0) {

                jQuery('.mma_box').css({
                    'border': '1px solid rgb(217, 60, 133)'
                });
                jQuery('#storetank').closest('.mma_box').css({
                    'border': '5px solid rgb(217, 60, 133)'
                });
                jQuery('.main-heading').addClass('text-danger');
                jQuery('.main-heading').text('Please fill in all required fields');

                return;
            }


            if ($('#activity_feedback').val().length == 0 || $('#activity_feedback').val().length < 20) {

                jQuery('#activity_feedback').closest('.mma_box').css({
                    'border': '5px solid rgb(217, 60, 133)'
                });

                jQuery('.character_error').show();
                return;
            }

            jQuery('.mma_box').css({
                'border': '1px solid rgb(217, 60, 133)'
            });

            $('#step_1_record').hide();
            $('#step_2_record').show();

            $('.main-heading').removeClass('text-danger');
            $('.main-heading').text('Create a New Record – Step 2 of 2');

            $('#ar_proceed_activity').hide();
            $('#ar_create_custom').hide();
            $('#ar_reset_record').hide();
            $('#ar_submit_activity').show();
            $('#ar_back_activity').show();

            // main back button
            $('#mma_header_back').hide();


            $('.recorded-start-time').each(function(index, recorded_element) {

                $(recorded_element).val($("#activity_start_time").val());

            });

            $('.recorded-end-time').each(function(index, recorded_element) {

                $(recorded_element).val($("#activity_end_time").val());

            });


        });

        $('#ar_back_activity').click(function() {

            $('#step_1_record').show();
            $('#step_2_record').hide();

            $('.main-heading').text('Create a New Record – Step 1 of 2');

            $('#ar_proceed_activity').show();
            $('#ar_submit_activity').hide();
            $('#ar_create_custom').show();
            $('#ar_reset_record').show();

            // main back button
            $('#mma_header_back').show();

            $('#ar_back_activity').hide();

        });

        jQuery('#activity_feedback').on('keyup', function() {

            var count = $(this).val().length;

            if (count < 20) {
                jQuery('.character_error').show();
                return;
            } else {
                jQuery('.character_error').hide();
            }

            if ($('#storetank').find('li').length == 1 && ($('.record-feedback-tr').length > 0 /*&& $('.record-feedback-tr').val().length == 0 */ )) {

                $('.record-feedback-tr').val($(this).val());

            }

            var feedback_text = this.value;

            $('.record-feedback-tr').each(function(index, recorded_element) {

                var recorded_feedback = $(recorded_element).attr('data-update-status');

                if (recorded_feedback.length == 0) {
                    $(recorded_element).val(feedback_text);
                }

            });

        });

        jQuery('#activity_end_time').on('change', function() {

            jQuery('.recorded-end-time').each(function(index, recorded_element) {

                $(recorded_element).val(this.value);

            });

        });

        jQuery('#activity_experience').on('change', function() {

            var experience = $(this).val();

            if ($('#storetank').find('li').length == 1 && ($('.experience-tr').length > 0 && $('.experience-tr').val() == 0)) {

                $('.experience-tr').val(experience);

            }


            $('.experience-tr').each(function(index, recorded_element) {

                var recorded_experience = $(recorded_element).attr('data-update-status');

                if (recorded_experience.length == 0) {
                    $(recorded_element).val(experience);
                }

            });


        })

        /**
         *  Update resident ID
         */
        jQuery(document).on('change', '.record-residents-list', function() {

            var resident_id = $(this).val();
            var parent_row = $(this).closest('tr.record-rows').attr('data-resident-id', resident_id);

        });


    });

    $(document).on('click', '#add_front_record', function() {

        ar_add_new_record(null);

    });

    $(document).on('click', '#ar_submit_activity', function() {


        var can_submit = true;
        $('#records_table .record-rows').each(function(index, row_element) {

            if ($(row_element).find('.record-residents-list').val().length == 0 ||
                $(row_element).find('.t_indoor_outdoor').val() == 0 ||
                $(row_element).find('.experience-tr').val() == 0) {

                jQuery(row_element).css({
                    'border': '3px solid rgb(217, 60, 133)'
                });
                jQuery('.main-heading').addClass('text-danger');
                jQuery('.main-heading').text('Please fill in all required fields');

                can_submit = false;
                return;

            }

        });


        if (can_submit) {

            $('#activity_record_table').submit();
            $('#loader').show();

        }

    });

    $(document).on('change', '.record-residents-list', function() {

        var resident_id = $(this).val();

        var resident_from_list = $('#list_view_first').find("[data-resident-id='" + resident_id + "']").clone();

        var store_tank = $('#storetank').find("[data-resident-id='" + resident_id + "']").clone();

        var recorded_residents_ids = [];

        jQuery('.record-residents-list').each(function(index, recorded_elements) {

            recorded_residents_ids.push($(recorded_elements).val());

        });

        jQuery('#storetank li').each(function(index, stored_elements) {

            var stored_clone = $(stored_elements).clone();

            var stored_resident_id = $(stored_elements).attr('data-resident-id');

            $('#list_view_first').prepend(stored_clone);
            $('#list_view_first').find(`[data-resident-id='${stored_resident_id}']`).find('img').attr('src', arrow_icon);
            $('#list_view_first').find(`[data-resident-id='${stored_resident_id}']`).find('a').removeClass('remove-resident');
            // add new classes
            $('#list_view_first').find(`li[data-resident-id='${stored_resident_id}']`).addClass('drag-resident');
            make_elements_dragable();
            // end changes

            $(stored_elements).remove();

        });

        jQuery('#list_view_first li').each(function(index, list_elements) {

            var list_resident_id = $(list_elements).attr('data-resident-id');

            if (jQuery.inArray(list_resident_id, recorded_residents_ids) !== -1) {

                var list_clone = $(list_elements).clone();
                $('#storetank').append(list_clone);
                $('#storetank').find(`[data-resident-id='${list_resident_id}']`).find('img').attr('src', remove_resident);
                $('#storetank').find(`[data-resident-id='${list_resident_id}']`).find('a').addClass('remove-resident');

                $(list_elements).remove();

            }

        });

        // add new classes
        $('#storetank').find('li').removeClass('drag-resident');
        // end changes


        refresh_resident_dropdown(resident_id);

        magic_sort_unordered_list('list_view_first', false);
    });

    $(document).on('change', '.recorded-element', function() {

        $(this).attr('data-update-status', 'true');

    });

    /**
     * ar_add_new_record
     *
     * @return void
     */
    function ar_add_new_record(resident_id) {

        var counter = jQuery('#records_table tbody .record-rows').length;

        var activity_date = jQuery('#activity_date').val();
        var activity_feedback = jQuery('#activity_feedback').val();
        var activity_start_time = jQuery('#activity_start_time').val();
        var activity_end_time = jQuery('#activity_end_time').val();
        var activity_experience = jQuery('#activity_experience').val();
        var activity_in_out = jQuery('input[name="activity_type"]:checked').val();
        var activity_indoor_checked = (activity_in_out == 'indoor') ? 'selected' : '';
        var activity_outdoor_checked = (activity_in_out == 'outdoor') ? 'selected' : '';

        var activity_experience_1 = (activity_experience == 1) ? 'selected' : '';
        var activity_experience_2 = (activity_experience == 2) ? 'selected' : '';
        var activity_experience_3 = (activity_experience == 3) ? 'selected' : '';
        var activity_experience_4 = (activity_experience == 4) ? 'selected' : '';
        var activity_experience_5 = (activity_experience == 5) ? 'selected' : '';
        var activity_experience_6 = (activity_experience == 6) ? 'selected' : '';
        var activity_experience_7 = (activity_experience == 7) ? 'selected' : '';
        var activity_experience_8 = (activity_experience == 8) ? 'selected' : '';
        var activity_experience_9 = (activity_experience == 9) ? 'selected' : '';
        var activity_experience_10 = (activity_experience == 10) ? 'selected' : '';

        var row_data = `<tr class="record-rows" data-resident-id="${resident_id}">
                            <td>
                                <select class="resident record-residents-list form-control select2 recorded-element" name="records[${counter}][participant]" style="width: 100%;" data-update-status="">
                                </select>
                            </td>
                            <td><input type="date" id="eventDate" name="records[${counter}][date]" class="form-control mma-input recorded-element" value="${activity_date}" data-update-status=""></td>
                            <td><input type="text" name="records[${counter}][start_time]" id="" class="form-control timepicker recorded-start-time" value="${activity_start_time}" data-update-status=""></td>
                            <td><input type="text" name="records[${counter}][end_time]" id="" class="form-control timepicker recorded-end-time" value="${activity_end_time}" data-update-status=""></td>
                            <td>
                                <select class="form-control t_indoor_outdoor recorded-element" required="" name="records[${counter}][indoor_outdoor]" style="width: 100%;" data-update-status="">
                                    <option value="0">Select</option>
                                    <option value="Indoor" ${activity_indoor_checked}>I</option>
                                    <option value="Outdoor" ${activity_outdoor_checked}>O</option>
                                </select>
                            </td>
                            <!--<td>
                                <select class="form-control t_type" required="" name="type[]">
                                <option value="0">Select</option>
                                <option value="Group">Group</option>
                                <option value="121">121</option>
                                </select>
                                <input type="hidden" name="" class="form-control t_type_handle" value="0">
                            </td>-->
                            <td style="width:90px !important">
                                <select id="" name="records[${counter}][experience]" class="form-control experience-tr recorded-element" data-update-status="">
                                    <option value="0">EXP</option>
                                    <option value="1" ${activity_experience_1}>1</option>
                                    <option value="2" ${activity_experience_2}>2</option>
                                    <option value="3" ${activity_experience_3}>3</option>
                                    <option value="4" ${activity_experience_4}>4</option>
                                    <option value="5" ${activity_experience_5}>5</option>
                                    <option value="6" ${activity_experience_6}>6</option>
                                    <option value="7" ${activity_experience_7}>7</option>
                                    <option value="8" ${activity_experience_8}>8</option>
                                    <option value="9" ${activity_experience_9}>9</option>
                                    <option value="10" ${activity_experience_10}>10</option>
                                </select>
                                <input type="hidden" name="" class="form-control experience_handle recorded-element" placeholder="Feedback" value="0">
                            </td>
                            <td><button type="button" class="btn btn-danger remove-record"><i class="fas fa-minus"></i></button></td>
                        </tr>
                        <tr>
                            <td colspan="7">
                                <input type="text" name="records[${counter}][feedback]" class="form-control record-feedback-tr recorded-element" placeholder="Feedback" value="${activity_feedback}" style="width: 98%;" data-update-status="">
                                <input type="hidden" name="" id="" class="form-control feedback_handle" placeholder="Feedback" value="0">
                            </td>
                        </tr>`;

        $("#records_table #records_table_body").append(row_data);

        // get residents
        var residents_data = $('#residents_data').val();

        if (residents_data.length > 0) {

            residents_data = residents_data;

            residents_data = jQuery.parseJSON(residents_data);
            var residents_list = $('.record-residents-list').last();

            residents_list = residents_list.empty();

            // default value

            if (resident_id == null) {
                residents_list.append($("<option></option>")
                    .attr("value", '')
                    .text('--Select--'));
            }

            var residents_not_available = [];

            var list_items = $('.record-residents-list');
            for (var i = 0; i < list_items.length; i++) {
                residents_not_available.push($(list_items[i]).val());
            }

            console.log(residents_not_available);

            $(residents_data).each(function(index, element) {

                var selected_resident = (element.user_id == resident_id) ? true : false;

                // if not exists already
                if (jQuery.inArray(element.user_id.toString(), residents_not_available) == -1) {

                    var resident_name = element.username.replace(/([A-Z])/g, ' $1').trim()

                    residents_list.append($("<option></option>")
                        .attr("value", element.user_id)
                        .prop('selected', selected_resident)
                        .text(resident_name));

                }

            });

        }

        $('.record-rows').last().find('.select2').select2();
        $('.datepicker').datepicker({
            clearBtn: true
        });
        $('.timepicker').timepicker({
            showMeridian: false
        });

        $('body').find('.table-responsive').animate({
            scrollTop: 1000
        }, 50);

        if (resident_id == null) {
            return;
        }

        refresh_resident_dropdown(resident_id);

    }

    // arrow icon
    var arrow_icon = 'https://magicmomentsportal.com/images/chevron.png';

    $(document).on('click', '.remove-record', function() {

        var resident_id = $(this).closest('tr').attr('data-resident-id');

        var element_data = $('#storetank').find(`li[data-resident-id="${resident_id}"]`).clone();


        // update icon
        $(element_data).find('img').attr('src', arrow_icon);
        $(element_data).find('a').removeClass('remove-resident');

        // add new classes
        $(element_data).addClass('drag-resident');
        // end changes

        // change image icon
        $('#storetank').find(`li[data-resident-id="${resident_id}"]`).remove();
        $('#list_view_first').prepend(element_data);


        make_elements_dragable();

        $(`.record-rows[data-resident-id="${resident_id}"]`).next('tr').remove();
        $(`.record-rows[data-resident-id="${resident_id}"]`).remove();

        // $(this).closest('tr').next('tr').remove();
        // $(this).closest('tr').remove();

        refresh_resident_dropdown(resident_id);

        magic_sort_unordered_list('list_view_first', false);

    });

    /**
     *  Remove Resident ID
     */
    jQuery(document).on('click', '.remove-resident', function(e) {

        e.stopImmediatePropagation();

        var resident_id = $(this).attr('data-resident-id');
        var element_data = $(this).closest('li').clone();

        // arrow icon
        var arrow_icon = 'https://magicmomentsportal.com/images/chevron.png';

        // update icon
        $(element_data).find('img').attr('src', arrow_icon);
        $(element_data).find('a').removeClass('remove-resident');
        // add new classes
        $(element_data).addClass('drag-resident');
        // end changes

        // change image icon
        $(this).closest('li').remove();
        $('#list_view_first').prepend(element_data);


        make_elements_dragable();

        $(`.record-rows[data-resident-id="${resident_id}"]`).next('tr').remove();
        $(`.record-rows[data-resident-id="${resident_id}"]`).remove();

        refresh_resident_dropdown(resident_id);

        magic_sort_unordered_list('list_view_first', false);

    });


    /**
     * ar_restrict_past_dates
     *
     * @return void
     */
    function ar_restrict_past_dates() {

        var dtToday = new Date();

        var month = dtToday.getMonth() + 1;
        var day = dtToday.getDate();
        var year = dtToday.getFullYear();
        if (month < 10)
            month = '0' + month.toString();
        if (day < 10)
            day = '0' + day.toString();

        var maxDate = year + '-' + month + '-' + day;

        // or instead:
        // var maxDate = dtToday.toISOString().substr(0, 10);

        $('.restrict-past-dates').attr('max', maxDate);
    }

    /**
     *  Display Image 
     */
    function display_image(input) {

        if (input.files && input.files[0]) {

            var reader = new FileReader();
            reader.onload = function(e) {

                $(input).closest('div').find('.box-image-preview')
                    .attr('src', e.target.result);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }
</script>

<!-- Generate reports scripts -->
<script>
    $('#ar_generate_report').click(function() {

        $('#ar_generate_report_table').submit();

        $('#loader').show();

    });

    // $('#ar_reset_report').click(function() {

    //     location.reload();
    //     $('#loader').show();

    // });


    /**
     *  Tracker changes
     */
    $(document).ready(function() {

        if (($('#ar_next_week_no').length > 0 && $('#ar_next_week_no').val().length == 0) || $('#ar_next_week_no').val() < 0) {

            $('#next_tracker').hide();
        }

    });


    $('#previous_tracker').click(function() {

        var previous_week_no = $('#ar_previous_week_no').val();
        previous_week_no = ($('#ar_previous_week_no').val().length == 0) ? 0 : parseInt(previous_week_no) + 1;

        // last slide
        $('#ar_previous_week_no').val(previous_week_no);

        var next_week_no = $('#ar_next_week_no').val();

        next_week_no = parseInt(previous_week_no) - 1;

        // upcoming slide
        $('#ar_next_week_no').val(next_week_no);

        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        $.ajax({
            type: 'POST',
            url: ar_get_weekly_tracker,
            dataType: 'JSON',
            data: {
                previous_week_no: previous_week_no,
                next_week_no: next_week_no,
                status: 'last_week'
            },
            beforeSend: function() {
                $('#loader').show();
            },
            success: function(result) {

                if (result.success) {
                    $('#tracker_heading').html(result.heading);
                    $('#ar_tracker_table').html(result.table);
                }

                if ($('#ar_next_week_no').val().length > 0 && (parseInt($('#ar_next_week_no').val()) >= -1)) {
                    $('#next_tracker').show();
                } else if ($('#ar_next_week_no').val().length > 0 || (parseInt($('#ar_next_week_no').val()) < -1)) {
                    $('#next_tracker').hide();
                }

                $('#loader').hide();
            },
            error: function(error) {
                $('#loader').hide();
            }
        });

    });
    

    $('#next_tracker').click(function() {

        var next_week_no = $('#ar_next_week_no').val();
        // next_week_no = ($('#ar_next_week_no').val() <= 0) ? 0 : next_week_no;
        // upcoming slide
        $('#ar_next_week_no').val(parseInt(next_week_no) - 1);

        var previous_week_no = $('#ar_previous_week_no').val();
        previous_week_no = ($('#ar_previous_week_no').val().length == 0) ? 1 : parseInt(previous_week_no) - 1;

        // last slide
        $('#ar_previous_week_no').val(previous_week_no);


        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        $.ajax({
            type: 'POST',
            url: ar_get_weekly_tracker,
            dataType: 'JSON',
            data: {
                previous_week_no: previous_week_no,
                next_week_no: next_week_no,
                status: 'next_week'
            },
            beforeSend: function() {
                $('#loader').show();
            },
            success: function(result) {

                if (result.success) {
                    $('#tracker_heading').html(result.heading);
                    $('#ar_tracker_table').html(result.table);
                }

                if ($('#ar_next_week_no').val().length > 0 && (parseInt($('#ar_next_week_no').val()) >= -1)) {
                    $('#next_tracker').show();
                } else if ($('#ar_next_week_no').val().length > 0 || (parseInt($('#ar_next_week_no').val()) < -1)) {
                    $('#next_tracker').hide();
                }

                $('#loader').hide();
            },
            error: function(error) {
                $('#loader').hide();
            }
        });

    });


    $('#ar_weekly_report_pdf').click(function() {
        var start_date = $('#ar_week_start_date').val();
        var end_date = $('#ar_week_end_date').val();

        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        var d = new Date();
        $.ajax({
            type: 'POST',
            url: ar_weekly_report_pdf,
            data: {
                start_date: start_date,
                end_date: end_date
            },
            xhrFields: {
                responseType: 'blob'
            },
            beforeSend: function() {
                $('#loader').show();
            },
            success: function(response) {

                var blob = new Blob([response]);
                var link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = `WeeklyReport-${current_date}.pdf`;
                link.click();

                $('#loader').hide();
            },
            error: function(error) {
                $('#loader').hide();
            }
        });

    });
    // Abid 251122 start
    $('body').on('click','#generate_evidence_report',function(){
        $('body').find('#ar_generate_evidence_report_table').submit();
        $('body').find('#loader').show();
    });
    $('body').find('.evidence_one_report_pdf').click(function() {
        var array_ids = [];
        var tr = $('body').find('#search_resutl').find('tbody').find('tr');
        tr.each(function(index) {
            if($(this).find('.single_select').prop('checked') == true)
            {
                var _id = $(this).find('.single_select').attr('data-id');
                array_ids.push(_id);
            }
        });
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        var type = $(this).attr('data-export-type');
        var d = new Date();
        var current_date = d.getFullYear() + "/" + (d.getMonth() + 1) + "/" + d.getDate();
        $.ajax({
            type: 'POST',
            url: evidence_one_report_pdf,
            data: {
                resident_id: $('body').find('#resident_id').val(),
                start_time: $('body').find('#start_time').val(),
                end_time: $('body').find('#end_time').val(),
                export_type: type,
                array_ids:array_ids,
            },
            xhrFields: {
                responseType: 'blob'
            },
            beforeSend: function() {
                $('#loader').show();
            },
            success: function(response) {
                var blob = new Blob([response]);
                var link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = `Evidence_Report-${current_date}.pdf`;
                link.click();
                $('#loader').hide();
            },
            error: function(error) {
                $('#loader').hide();
            }
        });
    });
    $('body').find('.generate_evidence_report_pdf').click(function() {
        var array_ids = [];
        var tr = $('body').find('#search_resutl').find('tbody').find('tr');
        tr.each(function(index) {
            if($(this).find('.single_select').prop('checked') == true)
            {
                var _id = $(this).find('.single_select').attr('data-id');
                array_ids.push(_id);
            }
        });
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });
        var type = $(this).attr('data-export-type');
        var d = new Date();
        var current_date = d.getFullYear() + "/" + (d.getMonth() + 1) + "/" + d.getDate();
        $.ajax({
            type: 'POST',
            url: ar_generate_evidence_pdf,
            data: {
                resident_id: $('body').find('#resident_id').val(),
                start_time: $('body').find('#start_time').val(),
                end_time: $('body').find('#end_time').val(),
                export_type: type,
                array_ids:array_ids
            },
            xhrFields: {
                responseType: 'blob'
            },
            beforeSend: function() {
                $('#loader').show();
            },
            success: function(response) {
                var blob = new Blob([response]);
                var link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = `Evidence_Report-${current_date}.pdf`;
                link.click();
                $('#loader').hide();
            },
            error: function(error) {
                $('#loader').hide();
            }
        });
    });
    // Abid 251122 end

    $('.ar_export_report').click(function() {

        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        var type = $(this).attr('data-export-type');

        var d = new Date();
        var current_date = d.getFullYear() + "/" + (d.getMonth() + 1) + "/" + d.getDate();


        $.ajax({
            type: 'POST',
            url: ar_get_filter_report,
            data: {
                activity_id: $('#activity_id').val(),
                coordinator: $('#coordinator').val(),
                resident_id: $('#resident_id').val(),
                category_id: $('#category_id').val(),
                start_time: $('#start_time').val(),
                end_time: $('#end_time').val(),
                group_or_single: $('#report_type').val(),
                indoor_outdoor: $('#indoor_outdoor').val(),
                export_type: type
            },
            xhrFields: {
                responseType: 'blob'
            },
            beforeSend: function() {
                $('#loader').show();
            },
            success: function(response) {

                var blob = new Blob([response]);
                var link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = `Report-${current_date}.pdf`;
                link.click();

                $('#loader').hide();
            },
            error: function(error) {
                $('#loader').hide();
            }
        });
    });

    $('.ar_export_monthly_pdf').click(function() {

        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        var month = $(this).attr('data-month');

        var d = new Date();
        var current_date = d.getFullYear() + "/" + (d.getMonth() + 1) + "/" + d.getDate();


        $.ajax({
            type: 'POST',
            url: ar_monthly_report_pdf,
            data: {
                month: month
            },
            xhrFields: {
                responseType: 'blob'
            },
            beforeSend: function() {
                $('#loader').show();
            },
            success: function(response) {

                var blob = new Blob([response]);
                var link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = `Monthly-${current_date}.pdf`;
                link.click();

                $('#loader').hide();
            },
            error: function(error) {
                $('#loader').hide();
            }
        });
    });
</script>

<!-- Dashboard scripts -->
<script type="text/javascript">
    $('.select2').select2();

    $(document).ready(function() {
        var start_date = $('#dashboard_start_date').val();
        var end_date = $('#dashboard_end_date').val();
        var type = $('#dashboard_type').val();
        var export_url = 'https://magicmomentsportal.com/activityreporting/export_ar_dashboard_pdf'+'/'+start_date+'/'+end_date+'/'+type;
        $('body').find('#export_ar_dashboard_pdf').attr('href',export_url);
        add_event_on_change();
        $('#ar_week_dashboard').click(function() {
            $('#dashboard_type').val('week');
            var resident_id = $(this).val();
            var start_date = $('#dashboard_current_start_date').val();
            var end_date = $('#dashboard_current_end_date').val();
            get_dashboarad_data(null, start_date, end_date);
        });
        $('#ar_month_dashboard').click(function() {
            $('#dashboard_type').val('month');
            var resident_id = $(this).val();
            var start_date = $('#dashboard_current_end_date').val();
            var end_date = $('#dashboard_current_end_date').val();
            get_dashboarad_data(null, start_date, end_date);
        });
        $('#ar_export_dashboard').click(function() {
            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });
            $('#dashboard_type').val('week');
            var resident_id = null;
            var start_date = $('#dashboard_start_date').val();
            var end_date = $('#dashboard_end_date').val();
            var type = $('#dashboard_type').val();
            $.ajax({
                type: 'POST',
                url: ar_dashboard_pdf,
                data: {
                    resident_id: resident_id,
                    start_date: start_date,
                    end_date: end_date,
                    dashboard_type: type
                },
                xhrFields: {
                    responseType: 'blob'
                },
                beforeSend: function() {
                    $('#loader').show();
                },
                success: function(response) {
                    var blob = new Blob([response]);
                    var link = document.createElement('a');
                    link.href = window.URL.createObjectURL(blob);
                    link.download = `Dashboard-${current_date}.pdf`;
                    link.click();
                    $('#loader').hide();
                },
                error: function(error) {
                    $('#loader').hide();
                }
            });
        });
        add_event_on_change();

        $('#ar_week_dashboard').click(function() {

            $('#dashboard_type').val('week');

            var resident_id = $(this).val();
            var start_date = $('#dashboard_current_start_date').val();
            var end_date = $('#dashboard_current_end_date').val();

            get_dashboarad_data(null, start_date, end_date);
        });

        $('#ar_month_dashboard').click(function() {

            $('#dashboard_type').val('month');

            var resident_id = $(this).val();
            var start_date = $('#dashboard_current_end_date').val();
            var end_date = $('#dashboard_current_end_date').val();

            get_dashboarad_data(null, start_date, end_date);

        });

        $('#ar_export_dashboard').click(function() {


            $.ajaxSetup({
                headers: {
                    'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                }
            });

            $('#dashboard_type').val('week');

            var resident_id = null;
            var start_date = $('#dashboard_start_date').val();
            var end_date = $('#dashboard_end_date').val();
            var type = $('#dashboard_type').val();

            $.ajax({
                type: 'POST',
                url: ar_dashboard_pdf,
                data: {
                    resident_id: resident_id,
                    start_date: start_date,
                    end_date: end_date,
                    dashboard_type: type
                },
                xhrFields: {
                    responseType: 'blob'
                },
                beforeSend: function() {
                    $('#loader').show();
                },
                success: function(response) {

                    var blob = new Blob([response]);
                    var link = document.createElement('a');
                    link.href = window.URL.createObjectURL(blob);
                    link.download = `Dashboard-${current_date}.pdf`;
                    link.click();

                    $('#loader').hide();
                },
                error: function(error) {
                    $('#loader').hide();
                }
            });

        });

    });

    var currentRequest = null;
    var get_dashboarad_data = function(resident_id, start_date, end_date) {
        var dashboard_type = ($('#dashboard_type').val().length == 0) ? 'week' : $('#dashboard_type').val();
        var export_url = 'https://magicmomentsportal.com/activityreporting/export_ar_dashboard_pdf'+'/'+start_date+'/'+end_date+'/'+dashboard_type;
        $('body').find('#export_ar_dashboard_pdf').attr('href',export_url);
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        // var dashboard_type = ($('#dashboard_type').val().length == 0) ? 'week' : $('#dashboard_type').val();

        currentRequest = $.ajax({
            type: 'POST',
            url: ar_get_dashboard_data,
            dataType: 'html',
            data: {
                resident_id: resident_id,
                start_date: start_date,
                end_date: end_date,
                dashboard_type: dashboard_type
            },
            beforeSend: function() {

                if (currentRequest != null) {
                    currentRequest.abort();
                    $('#loader').hide();
                }
                $('#loader').show();
            },
            success: function(result) {

                $('body').find('#dashboard_main_view').html(result);
                add_event_on_change();
                $('#loader').hide();
            },
            error: function(error) {
                $('#loader').hide();
            }
        });
    }

    /**
     * add_event_on_change
     *
     * @return void
     */
    function add_event_on_change() {

        $("#dashboard_main_view").delegate("#dashboard_select_resident", "change", function() {

            var resident_id = $(this).val();
            var start_date = $('#dashboard_start_date').val();
            var end_date = $('#dashboard_end_date').val();

            if (resident_id.length == 0) return;

            get_dashboarad_data(resident_id, start_date, end_date);

        });

        $("#dashboard_main_view").delegate("#previous_dashboard", "click", function() {

            var resident_id = $(this).val();
            var start_date = $('#prev_start_date').val();
            var end_date = $('#prev_end_date').val();

            get_dashboarad_data(null, start_date, end_date);

        });

        $("#dashboard_main_view").delegate("#next_dashboard", "click", function() {

            var resident_id = $(this).val();
            var start_date = $('#next_start_date').val();
            var end_date = $('#next_end_date').val();

            get_dashboarad_data(null, start_date, end_date);

        });

    }

    $('#ar_export_dashboard').click(function() {

        // var prtContent = document.getElementById("dashboard_main_view");
        // var WinPrint = window.open('', '', 'left=0,top=0,width=800,height=900,toolbar=0,scrollbars=0,status=0');
        // WinPrint.document.write(prtContent.innerHTML);
        // WinPrint.document.close();
        // WinPrint.focus();
        // WinPrint.print();
    });
</script>
<script>
    // Stories
    $(".story_youtube_link").keyup(function(e) {
        var element = this;
        var yt = $(element).val();

        if (yt != '') {
            // story title required
            $(element).closest(".userfile").find(".attachment_title").prop("required", true);
        } else {
            $(element).closest(".userfile").find(".attachment_title").prop("required", false);
        }
    });

    // load preview of video url
    jQuery(document).on("click", ".load-video-preview", function() {
        var parent = jQuery(this).closest(".input-group");
        var video_url = jQuery(parent).find("input").val();

        if (
            video_url.length > 0 &&
            video_url.indexOf("youtube") >= 0 &&
            video_url.indexOf("v=") >= 0
        ) {
            var url_data = video_url.split("v=");
            var url_id = url_data[1].split("&");
            var img = `https://img.youtube.com/vi/${url_id}/hqdefault.jpg`;
            jQuery(this)
                .closest(".userfile")
                .find(".imageViewer")
                .attr("src", img);
        } else {
            jQuery(this)
                .closest(".userfile")
                .find(".imageViewer")
                .attr("src", "https://img.icons8.com/ultraviolet/344/cloud-file.png");
        }
    });
</script>

<script>
    var calentim_picker_config_start = {
        inline: false,
        showHeader: false,
        showFooter: false,
        showCalendars: false,
        singleDate: true,
        format: "HH:mm",
        hourFormat: 24,
        startDate: moment().subtract(30, "minute"),
        minuteSteps: 10,
        autoCloseOnSelect: true,
        reverseTimepickerArrows: true,
        enableKeyboard: false,
    };
    var calentim_picker_end_config = {
        inline: false,
        showHeader: false,
        showFooter: false,
        showCalendars: false,
        singleDate: true,
        format: "HH:mm",
        hourFormat: 24,
        autoCloseOnSelect: true,
        minuteSteps: 10,
        reverseTimepickerArrows: true,
        enableKeyboard: false
    };

    var date_calentime = {
        inline: false,
        showHeader: false,
        showFooter: false,
        calendarCount: 1,
        singleDate: true,
        autoCloseOnSelect: true,
        format: "DD/MM/YYYY",
        // maxDate:moment().add(0, "day").endOf("day"),
        showTimePickers: false,
    };

    $(document).ready(function() {

        $("#activity_start_time").calentim(calentim_picker_config_start);
        $("#activity_end_time").calentim(calentim_picker_end_config);

        // $("#start_time").calentim(date_calentime);
        // $("#end_time").calentim(date_calentime);

    });
</script>

<script>
    function magic_sort_unordered_list(ul, sortDescending) {
        if (typeof ul == "string")
            ul = document.getElementById(ul);

        // Idiot-proof, remove if you want
        if (!ul) {
            alert("The UL object is null!");
            return;
        }

        // Get the list items and setup an array for sorting
        var lis = ul.getElementsByTagName("li");
        var vals = [];

        // Populate the array
        for (var i = 0, l = lis.length; i < l; i++)
            vals.push(lis[i].innerHTML);

        // Sort it
        vals.sort();

        // Sometimes you gotta DESC
        if (sortDescending)
            vals.reverse();

        // Change the list on the page
        for (var i = 0, l = lis.length; i < l; i++) {
            lis[i].innerHTML = vals[i];

            // new code added
            data_resident_id = $(lis[i]).find("a").attr("data-resident-id");
            $(lis[i]).attr("data-resident-id", data_resident_id);

        }
    }
</script>

<script>
    function refresh_resident_dropdown(resident_id) {

        var list_items = $('.record-residents-list');

        // get residents
        var residents_data = $('#residents_data').val();
        residents_data = jQuery.parseJSON(residents_data);

        var residents_not_available = [];

        for (var i = 0; i < list_items.length; i++) {
            residents_not_available.push($(list_items[i]).val());
        }


        for (var i = 0; i < list_items.length; i++) {

            var residents_not_avail = residents_not_available.slice();
            residents_not_avail.splice(i, 1);

            var resident_list = list_items[i];
            resident_list = $(resident_list).empty();

            var options = ``;

            if (residents_not_available[i] == '') {
                options += `<option value="">--Select--</option>`;
            }

            $(residents_data).each(function(index, element) {


                var selected_resident = (residents_not_available[i] == element.user_id.toString()) ? "selected" : '';

                // if not exists already
                if (jQuery.inArray(element.user_id.toString(), residents_not_avail) == -1) {

                    var resident_name = element.username.replace(/([A-Z])/g, ' $1').trim()

                    options += `<option value="${element.user_id}" ${selected_resident}>${resident_name}</option>`;
                    resident_list.html(options);
                }

            });
        }
    }
</script>
</body>

</html>